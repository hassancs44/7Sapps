<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>STOR7S | ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª (IT)</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');
*,
*::before,
*::after{
  box-sizing:border-box;
}

body{
  margin:0;
  font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial;
  color:#0B1220;
  background:#F1F5F9;
}

.topbar{
  background:#FFFFFF;
  padding:16px 18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid rgba(15,23,42,.10);
  box-shadow:0 6px 18px rgba(2,6,23,.08);
}
.topbar *{
  color:#0B1220;
  font-weight:700;
}

.btn{
  background:linear-gradient(180deg,#0B5ED7,#0A3E9A);
  border:0;
  padding:10px 14px;
  border-radius:14px;
  color:#fff;
  cursor:pointer;
  font-weight:600;
  box-shadow:0 8px 18px rgba(11,94,215,.22);
}

.btn.red{
  background:linear-gradient(180deg,#DC2626,#991B1B);
}

.btn.green{
  background:linear-gradient(180deg,#16A34A,#15803D);
}

.card{
  background:#FFFFFF;
  padding:20px;
  border-radius:18px;
  margin:14px auto;
  max-width:1200px;
  border:1px solid rgba(15,23,42,.10);
  box-shadow:0 14px 40px rgba(2,6,23,.10);
}

input,select,textarea{
  width:100%;
  max-width:100%;
  display:block;

  padding:12px 14px;
  margin-top:6px;
  border-radius:14px;
  background:#FFFFFF;
  color:#0B1220;
  border:1px solid rgba(15,23,42,.10);
  font-size:14px;
}
input:focus,select:focus,textarea:focus{
  outline:none;
  border-color:rgba(11,94,215,.5);
  box-shadow:0 0 0 4px rgba(11,94,215,.12);
}

table{
  width:100%;
  max-width:100%;
  border-collapse:collapse;
  margin-top:14px;
  border-radius:14px;
  overflow:hidden;
  background:#FFFFFF;
}

th,td{
  padding:12px;
  border-bottom:1px solid rgba(15,23,42,.08);
  font-size:14px;
  color:#0B1220;
}
th{
  background:#F1F5F9;
  font-weight:700;
}

</style>
</head>

<body>

<div class="topbar">
  <div>ğŸ’» STOR7S | ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</div>
  <button class="btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<div class="card">
  <h2>ğŸ“© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
  <button class="btn" onclick="loadIT()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
  <table id="tblIT"><tbody></tbody></table>
</div>

<div class="card">
  <h2>ğŸ› ï¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙÙ†ÙŠ</h2>
  <input id="req" type="number" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨">
  <select id="type">
  <option>ØµÙŠØ§Ù†Ø©</option>
  <option>ØªØ§Ù„Ù</option>
  <option>Ø§Ø³ØªØ¨Ø¯Ø§Ù„</option>
  <option>Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯</option>
</select>

<select id="recommend">
  <option>Ø´Ø±Ø§Ø¡</option>
  <option>ØµØ±Ù</option>
  <option>Ø§Ø³ØªØ¨Ø¯Ø§Ù„</option>
  <option>Ø¥ØºÙ„Ø§Ù‚</option>
</select>

<textarea id="notes" placeholder="Ø§Ù„ÙˆØµÙ Ø§Ù„ÙÙ†ÙŠ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ"></textarea>
<input id="tech" placeholder="Ø§Ø³Ù… Ø§Ù„ÙÙ†ÙŠ">


  <h3>ğŸ“ Ø±ÙØ¹ Ù…Ø±ÙÙ‚ Ù„Ù„ØªÙ‚Ø±ÙŠØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</h3>
  <input type="file" id="file">

  <button class="btn green" onclick="sendBack()">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯ Ù„Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</button>

    <div class="card">
  <h2>ğŸ›’ Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ø¬Ø¯ÙŠØ¯ (IT)</h2>

  <input id="desc" placeholder="ÙˆØµÙ Ø§Ù„Ø·Ù„Ø¨">

  <input id="item_name" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
  <input id="item_qty" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">

  <button class="btn green" onclick="sendPurchase()">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</button>
</div>

</div>


<script>
const API = "/api/core/it";
// ====================== Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ======================
async function loadIT(){
  let res = await fetch(API+"/incoming");
  let data = await res.json();
  let rows="";
  for(let r of data){
    rows += `
    <tr>
      <td>${r.Ø±Ù‚Ù…_Ø§Ù„Ø·Ù„Ø¨}</td>
      <td>${r.Ø§Ù„Ø­Ø§Ù„Ø©}</td>
    </tr>`;
  }
  document.querySelector("#tblIT tbody").innerHTML = rows;
}

// ====================== Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„ÙØ­Øµ ======================
async function sendBack(){
  let fd = new FormData();
  fd.append("Ø±Ù‚Ù…_Ø§Ù„Ø·Ù„Ø¨", document.getElementById("req").value);
  fd.append("Ù†ÙˆØ¹_Ø§Ù„ØªÙ‚ÙŠÙŠÙ…", document.getElementById("type").value);
  fd.append("Ø§Ù„ØªÙˆØµÙŠØ©", document.getElementById("recommend").value);
  fd.append("Ø§Ù„ÙˆØµÙ_Ø§Ù„ÙÙ†ÙŠ", document.getElementById("notes").value);
  fd.append("Ø§Ø³Ù…_Ø§Ù„ÙÙ†ÙŠ", document.getElementById("tech").value);

  let f = document.getElementById("file").files[0];
  if(f) fd.append("file", f);

  await fetch(API + "/evaluate", { method:"POST", body:fd });

  alert("âœ”ï¸ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù„Ù„Ù…Ø´ØªØ±ÙŠØ§Øª");
  loadIT();
}

// ====================== ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ ======================
function logout(){ localStorage.clear(); location.reload(); }

// ØªØ­Ù…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
loadIT();

    async function sendPurchase(){
  const user = JSON.parse(localStorage.getItem("user") || "{}");

  const payload = {
    Ø±Ù‚Ù…_Ø§Ù„Ø·Ù„Ø¨: Date.now().toString(),
    Ø§Ù„ÙˆØµÙ: document.getElementById("desc").value,
    user: user,
    items: [{
      Ø§Ø³Ù…: document.getElementById("item_name").value,
      ÙƒÙ…ÙŠØ©: document.getElementById("item_qty").value
    }]
  };

  await fetch(API + "/create-request", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(payload)
  });

  alert("âœ”ï¸ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡ Ù„Ù„Ù…Ø´ØªØ±ÙŠØ§Øª");
}

</script>

</body>
</html>
