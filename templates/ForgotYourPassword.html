<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± | SEVENS</title>
<!-- PWA -->
<link rel="manifest" href="/static/manifest.json">
<meta name="theme-color" content="#0B5ED7">

<!-- iOS Web App -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="SEVENS">

<link rel="apple-touch-icon" sizes="180x180" href="/static/icons/ios/180.png">
<link rel="apple-touch-icon" sizes="167x167" href="/static/icons/ios/167.png">
<link rel="apple-touch-icon" sizes="152x152" href="/static/icons/ios/152.png">
<link rel="apple-touch-icon" sizes="120x120" href="/static/icons/ios/120.png">

  <!-- Ø§Ù„Ø®Ø·ÙˆØ· ÙˆØ§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Tajawal', sans-serif;
    }

    body {
  margin:0;
  font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial;
  color:#0B1220;
  background:
    radial-gradient(1200px 600px at 80% 10%, rgba(11,94,215,.18), transparent 60%),
    radial-gradient(900px 500px at 10% 80%, rgba(10,62,154,.14), transparent 60%),
    #F7FAFF;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:18px;
    padding-bottom: env(safe-area-inset-bottom);
  -webkit-tap-highlight-color: transparent;

}



    .container {
  width:100%;
  max-width:420px;
  background:#FFFFFF;
  border-radius:18px;
  padding:28px;
  text-align:center;
  box-shadow:0 14px 40px rgba(2,6,23,.12);
  border:1px solid rgba(15,23,42,.10);
}


    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .logo-box {
  width:72px;
  height:72px;
  margin:0 auto 18px;
  border-radius:18px;
  background:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  box-shadow:0 12px 30px rgba(11,94,215,.25);
}

    .login-title {
  font-size:22px;
  font-weight:700;
  color:#0B1220;
  margin-bottom:8px;
}


    .subtitle {
  color:#6B7280;
  font-size:14px;
  margin-bottom:22px;
  line-height:1.7;
}


    .input-field {
      text-align: right;
      margin-bottom: 18px;
    }

    .input-field input {
  width:100%;
  padding:12px 14px;
  border-radius:14px;
  border:1px solid rgba(15,23,42,.10);
  outline:none;
  font-size:14px;
  background:#fff;
    font-size: 16px;
}


    .input-field input:focus {
  border-color:rgba(11,94,215,.5);
  box-shadow:0 0 0 4px rgba(11,94,215,.12);
}


    .btn-send {
  width:100%;
  margin-top:10px;
  padding:10px 14px;
  background:#0B5ED7;
  color:white;
  border-radius:14px;
  border:none;
  font-size:14px;
  font-weight:600;
  cursor:pointer;
  box-shadow:0 8px 18px rgba(11,94,215,.22);
    touch-action: manipulation;
}

    .btn-send:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-reset {
  width:100%;
  margin-top:16px;
  padding:12px 14px;
  border:none;
  border-radius:14px;
  cursor:pointer;
  color:white;
  font-weight:700;
  font-size:15px;
  background:linear-gradient(180deg,#0B5ED7,#0A3E9A);
  box-shadow:0 12px 25px rgba(11,94,215,.22);
    touch-action: manipulation;
}

    .message {
  margin-top:14px;
  padding:12px 14px;
  border-radius:14px;
  font-size:14px;
  font-weight:600;
  display:none;
}

    .success {
  background:rgba(11,94,215,.08);
  color:#0B5ED7;
  border:1px solid rgba(11,94,215,.25);
  display:block;
}

    .error {
  background:rgba(220,38,38,.08);
  color:#991B1B;
  border:1px solid rgba(220,38,38,.25);
  display:block;
}


    .back {
      margin-top: 20px;
      font-size: 14px;
    }

    .back a {
  color:#0B5ED7;
  text-decoration:none;
  font-weight:600;
}


      /* ğŸ“± Mobile Responsive */
@media (max-width: 480px) {

  .container {
    padding: 22px;
    border-radius: 16px;
  }

  .login-title {
    font-size: 20px;
  }

  .subtitle {
    font-size: 13px;
  }

  .btn-send,
  .btn-reset {
    font-size: 14px;
  }
}

  </style>
</head>

<body>

<div class="container">

  <!-- Logo -->
  <div class="logo-box">
    <img src="{{ url_for('static', filename='7s.jpg') }}" width="80">
  </div>

  <div class="login-title">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</div>
  <div class="subtitle">Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØŒ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ØŒ Ø«Ù… ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©.</div>

  <!-- Email -->
  <div class="input-field">
    <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" />
    <button class="btn-send" id="otpBtn" onclick="sendOTP()">Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚</button>
  </div>

  <!-- OTP -->
  <div class="input-field">
    <input type="text" id="otp" placeholder="Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ (6 Ø£Ø±Ù‚Ø§Ù…)" maxlength="6" />
  </div>

  <!-- New Password -->
  <div class="input-field">
    <input type="password" id="newPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" />
  </div>

  <!-- Confirm Password -->
  <div class="input-field">
    <input type="password" id="confirmPassword" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" />
  </div>

  <!-- Messages -->
  <div id="msg" class="message"></div>

  <!-- Reset Button -->
  <button class="btn-reset" onclick="resetPassword()">ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>

  <div class="back">
    <a href="Login.html">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
  </div>

</div>

<script>

    if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker
      .register("/static/service-worker.js")
      .catch(err => console.log("SW error", err));
  });
}
let timer = null;
let seconds = 60;

/* === Snackbar Messages === */
function showMessage(text, type) {
  const msg = document.getElementById("msg");
  msg.textContent = text;
  msg.className = "message " + type;
  msg.style.display = "block";

  setTimeout(() => msg.style.display = "none", 4500);
}

/* === OTP Timer === */
function startTimer() {
  const btn = document.getElementById("otpBtn");
  btn.disabled = true;

  seconds = 60;
  btn.textContent = `Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø¹Ø¯ ${seconds} Ø«Ø§Ù†ÙŠØ©`;

  timer = setInterval(() => {
    seconds--;
    btn.textContent = `Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø¹Ø¯ ${seconds} Ø«Ø§Ù†ÙŠØ©`;

    if (seconds <= 0) {
      clearInterval(timer);
      btn.disabled = false;
      btn.textContent = "Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚";
    }
  }, 1000);
}

/* === Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ === */
async function sendOTP() {
  const email = document.getElementById("email").value.trim();

  if (!email) return showMessage("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ", "error");

  try {
    const res = await fetch("/api/send_reset_code", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email })
    });

    const data = await res.json();
    if (data.success) {
      showMessage("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ", "success");
      startTimer();
    } else {
      showMessage(data.message || "Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø²", "error");
    }

  } catch {
    showMessage("ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…", "error");
  }
}

/* === Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± === */
async function resetPassword() {
  const email = document.getElementById("email").value.trim();
  const otp = document.getElementById("otp").value.trim();
  const pass1 = document.getElementById("newPassword").value;
  const pass2 = document.getElementById("confirmPassword").value;

  if (!email || !otp || !pass1 || !pass2)
    return showMessage("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„", "error");

  if (otp.length !== 6)
    return showMessage("Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 6 Ø£Ø±Ù‚Ø§Ù…", "error");

  if (pass1 !== pass2)
    return showMessage("ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†", "error");

  if (pass1.length < 4)
    return showMessage("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù‚ØµÙŠØ±Ø© Ø¬Ø¯Ù‹Ø§", "error");

  // Verify code
  const verifyRes = await fetch("/api/verify_reset_code", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ code: otp })
  });

  const verifyData = await verifyRes.json();
  if (!verifyData.success)
    return showMessage("Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­", "error");

  // Reset password
  try {
    const res = await fetch("/api/forgot_reset_password", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, otp, newPassword: pass1 })
    });

    const data = await res.json();
    if (data.success) {
      showMessage("ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­", "success");

      setTimeout(() => {
        window.location.href = "Login.html";
      }, 2500);
    } else {
      showMessage(data.message || "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«", "error");
    }

  } catch {
    showMessage("ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…", "error");
  }
}

</script>

</body>
</html>
